# Теги шаблона django-parler

Все переведенные поля можно читать как обычные поля, просто используя как:

```django
{{ object.fieldname }}
```

Когда перевод для поля недоступен, будет выведена пустая строка (или **TEMPLATE\_STRING\_IF\_INVALID**). Система шаблонов Django безопасно игнорирует исключение **TranslationDoesNotExist**, которое обычно генерируется в коде; это потому, что это исключение наследуется от **AttributeError**.

В других ситуациях вам может понадобиться использовать теги шаблона, например:

* Получение переведенного URL текущей страницы или любого другого объекта.
* Переключение языка объекта, например. для отображения полей на другом языке.
* Получение переведенных полей потокобезопасным способом (для общих объектов).

Чтобы использовать загрузки шаблона, добавьте это в начало шаблона:

```django
{% raw %}
{% load parler_tags %}
{% endraw %}
```

## Получение переведенного URL

Тег **get\_translated\_url** можно использовать для получения правильного URL-адреса этой страницы на другом языке. Если URL-адрес не может быть сгенерирован, вместо него возвращается пустая строка.

Этот алгоритм выполняет подход «максимальных усилий», чтобы дать правильный URL-адрес. Если это не удается, добавьте **ViewUrlMixin** в свое представление, чтобы создать правильный URL-адрес.

Пример, чтобы построить языковое меню:

```django
{% raw %}
{% load i18n parler_tags %}

<ul>
    {% for lang_code, title in LANGUAGES %}
        {% get_language_info for lang_code as lang %}
        {% get_translated_url lang_code as tr_url %}
        {% if tr_url %}<li{% if lang_code == LANGUAGE_CODE %} class="is-selected"{% endif %}><a href="{{ tr_url }}" hreflang="{{ lang_code }}">{{ lang.name_local|capfirst }}</a></li>{% endif %}
    {% endfor %}
{% endraw %}
</ul>
```

Чтобы сообщить поисковым системам о переведенных страницах:

```python
{% raw %}
{% load i18n parler_tags %}

{% for lang_code, title in LANGUAGES %}
    {% get_translated_url lang_code as tr_url %}
    {% if tr_url %}<link rel="alternate" hreflang="{{ lang_code }}" href="{{ tr_url }}" />{% endif %}
{% endfor %}
{% endraw %}
```

{% hint style="info" %}
Использование этого тега не является потокобезопасным, если объект совместно используется несколькими потоками. Это временно изменяет текущий язык объекта.
{% endhint %}

## Изменение языка объекта

Чтобы переключить объектный язык, используйте:

```django
{% raw %}
{% objectlanguage object "en" %}
  {{ object.title }}
{% endobjectlanguage %}
{% endraw %}
```

На **TranslatableModel** не влияет тег `{% language .. %}`, поскольку он сохраняет свое собственное состояние. Использование этого тега временно переключает состояние объекта.

{% hint style="info" %}
Использование этого тега не является потокобезопасным, если объект совместно используется несколькими потоками. Это временно изменяет текущий язык объекта.
{% endhint %}

## Примечания по безопасности потоков

Использование тегов `{% get_translated_url %}` или `{% objectlanguage %}` не является потокобезопасным, если объект совместно используется несколькими потоками. Это временно изменяет текущий язык объекта представления. Потокобезопасность редко является проблемой в шаблонах, когда все объекты извлекаются из базы данных в представлении.

Один из примеров, когда это может произойти, - это когда у вас есть объекты, кэшированные в глобальных переменных. Например, это вызывает присоединение объектов к модели **Site**. Общий объект возвращается при доступе к этим объектам с помощью **Site.objects.get\_current().my\_object**. Это связано с тем, что платформа сайтов хранит глобальный кеш всех объектов **Site**, а отношение **my\_object** также кэшируется ORM. Следовательно, объект является общим для всех запросов.

В случае, если объект используется несколькими потоками, безопасным способом доступа к переведенному полю является использование фильтра шаблона **get\_translated\_field** или его собственного варианта:

```django
{{ object|get_translated_field:'name' }}
```

Это позволяет избежать изменения языка объекта **object** вызовом `set_current_language()`. Вместо этого он напрямую считывает переведенное поле, используя `safe_translation_getter()`. Поле извлекается в текущем шаблоне Django и соответствует настройкам языка проекта (используются ли резервные варианты и настройка **any\_language**).
